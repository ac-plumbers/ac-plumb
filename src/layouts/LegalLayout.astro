---
import BaseLayout from './BaseLayout.astro';
import Text from '@/components/fundations/elements/Text.astro';
import Kicker from '@/components/fundations/elements/Kicker.astro';
import Wrapper from '@/components/fundations/containers/Wrapper.astro';
import ContactBlock from '@/components/contact/ContactBlock.astro';
import { getEntry } from 'astro:content';

export interface Props {
  slug: string;
}

const { slug } = Astro.props;

// Fetch content from legal collection using getEntry
const entry = await getEntry('legal', slug);

if (!entry) {
  throw new Error(`Legal entry not found for slug: ${slug}`);
}

const { Content } = await entry.render();
const { data } = entry;

const {
  title,
  description,
  keywords,
  author = 'AC Plumbers Ltd.',
  datePublished,
  dateModified,
  page,
  pubDate,
} = data;
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  author={author}
  datePublished={datePublished}
  dateModified={dateModified}>
  <section class='bg-primary-00'>
    <Wrapper
      variant='standard'
      class='py-12 pt-48 lg:border-x lg:border-white/10'>
      <div class='mx-auto max-w-xl text-center text-balance lg:col-span-2'>
        <Kicker class='text-white-00'>Legal</Kicker>
        <Text
          tag='h1'
          variant='displayMD'
          class='mt-12 font-medium tracking-tight text-white-00'>
          {page || title}
        </Text>
        <Text tag='p' variant='textLG' class='mt-4 text-white-00'>
          Last updated on
          <time datetime={new Date(pubDate).toISOString()}>
            {
              new Date(pubDate).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: '2-digit',
              })
            }
          </time>
        </Text>
      </div>
    </Wrapper>
  </section>
  <section>
    <Wrapper variant='standard' class='py-12'>
      <Wrapper variant='narrow' class='mx-auto'>
        <Wrapper variant='legal'>
          <Content />
        </Wrapper>
      </Wrapper>
    </Wrapper>
    <ContactBlock />
  </section>
</BaseLayout>
