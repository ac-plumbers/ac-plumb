---
import ServicesLayout from "@/layouts/ServicesLayout.astro";
import ServicesHero from "../../components/services/home-services/ServicesHero.astro";
import FeaturedServices from "../../components/services/home-services/FeaturedServices.astro";
import { getCollection } from "astro:content";
import ServicesByCategory from "../../components/services/home-services/ServicesByCategory.astro";
import CallToActionServices from "../../components/services/home-services/CallToActionServices.astro";

// Get all services
const allServices = await getCollection("services");

// Featured services for special display
const featuredServices = allServices
  .filter((service) => Boolean(service.data.featured))
  .slice(0, 3);

// All services sorted (featured first, then alphabetically)
const services = [...allServices].sort((a, b) => {
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return a.data.title.localeCompare(b.data.title);
});

// Group services by category
const servicesByCategory = services.reduce(
  (acc, service) => {
    const category = (service.data.category || "general").toLowerCase();
    if (!acc[category]) acc[category] = [];
    acc[category].push(service);
    return acc;
  },
  {} as Record<string, typeof services>,
);

const title = "Professional Plumbing Services in Brighton - AC Plumbers Ltd";
const description =
  "From emergency repairs to complete installations, our Gas Safe certified engineers deliver professional plumbing, heating, and gas services across Brighton & Hove.";
const ctaPrimary = { text: "Browse Our Services", href: "#featured-services" };
const ctaSecondary = { text: "Get Free Quote", href: "/contact-us" };
const canonical = "https://acplumb.co.uk/services/";
const decorativeElements = true;
---

<ServicesLayout title={title} description={description} canonical={canonical}>
  <!-- Hero Section with Gradient Background -->
  <ServicesHero
    title={title}
    description={description}
    ctaPrimary={ctaPrimary.text}
    ctaSecondary={ctaSecondary.text}
    decorativeElements={decorativeElements}
  />

  <!-- Featured Services Section -->
  <FeaturedServices featuredServices={featuredServices} />

  <!-- All Services by Category -->
  <ServicesByCategory servicesByCategory={servicesByCategory} />

  <!-- Enhanced Call to Action -->
  <CallToActionServices />
</ServicesLayout>
