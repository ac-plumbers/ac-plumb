---
import Layout from '../layouts/Layout.astro';
import '@/styles/global.css';
import '@fontsource-variable/inconsolata';
import '@fontsource/lato';
import { Image } from 'astro:assets';
import logo from '../images/logo/ac-plumbers-logo-brighton.png';
---

<Layout>
  <section
    class='relative flex min-h-screen w-full flex-col items-center justify-center bg-primary-700 px-2 sm:px-0'>
    <div
      class='mx-auto flex min-h-[80vh] w-full max-w-2xl flex-col items-center justify-center gap-8 py-8 sm:py-16'>
      <Image
        src={logo}
        alt='AC Plumbers Ltd. logo'
        width={220}
        height={220}
        format='webp'
        class='mb-2 drop-shadow-lg sm:mb-4'
      />
      <div class='flex w-full flex-col items-center justify-center gap-8'>
        <div class='flex w-full flex-col items-center gap-3'>
          <h1
            class='font-manrope text-center text-2xl leading-tight font-bold text-accent-500 sm:text-3xl md:text-5xl'>
            We're Building Something New
          </h1>
          <p
            class='max-w-lg px-2 text-center text-sm text-gray-200 sm:text-base'>
            We're working hard to bring you a new online experience for AC
            Plumbers Ltd. For urgent plumbing, heating, or gas services in
            Brighton & Hove, please contact us below.
          </p>
        </div>
        <div
          class='count-down-main flex w-full flex-wrap items-start justify-center gap-2 sm:gap-4'>
          <div class='timer flex flex-col gap-0.5'>
            <div class=''>
              <h3
                class='countdown-element days font-manrope text-center text-2xl leading-9 font-bold text-white'>
              </h3>
            </div>
            <p
              class='w-full text-center text-xs leading-normal font-normal text-gray-300'>
              DAYS
            </p>
          </div>
          <h3
            class='font-manrope w-3 text-center text-2xl leading-9 font-medium text-gray-300'>
            :
          </h3>
          <div class='timer flex flex-col gap-0.5'>
            <div class=''>
              <h3
                class='countdown-element hours font-manrope text-center text-2xl leading-9 font-bold text-white'>
              </h3>
            </div>
            <p
              class='w-full text-center text-xs leading-normal font-normal text-gray-300'>
              HRS
            </p>
          </div>
          <h3
            class='font-manrope w-3 text-center text-2xl leading-9 font-medium text-gray-300'>
            :
          </h3>
          <div class='timer flex flex-col gap-0.5'>
            <div class=''>
              <h3
                class='countdown-element minutes font-manrope text-center text-2xl leading-9 font-bold text-white'>
              </h3>
            </div>
            <p
              class='w-full text-center text-xs leading-normal font-normal text-gray-300'>
              MINS
            </p>
          </div>
          <h3
            class='font-manrope w-3 text-center text-2xl leading-9 font-medium text-gray-300'>
            :
          </h3>
          <div class='timer flex flex-col gap-0.5'>
            <div class=''>
              <h3
                class='countdown-element seconds font-manrope text-center text-2xl leading-9 font-bold text-white'>
              </h3>
            </div>
            <p
              class='w-full text-center text-xs leading-normal font-normal text-gray-300'>
              SECS
            </p>
          </div>
        </div>
        <div class='flex w-full flex-col items-center justify-center gap-3'>
          <h6
            class='text-center text-sm font-semibold text-accent-500 sm:text-base'>
            Estimated Launch: February 28, 2026
          </h6>
          <form
            name='launch-notification'
            method='POST'
            data-netlify='true'
            netlify-honeypot='bot-field'
            class='mx-auto flex w-full max-w-md flex-col items-center justify-center gap-2 sm:flex-row'>
            <input type='hidden' name='form-name' value='launch-notification' />
            <p class='sr-only'>
              <label>
                Don’t fill this out if you’re human:
                <input name='bot-field' />
              </label>
            </p>
            <input
              type='email'
              name='email'
              required
              class='inline-flex h-10 w-full max-w-full items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 placeholder-gray-400 shadow focus:outline-none sm:w-80'
              placeholder='Your email for updates...'
            />
            <button
              type='submit'
              class='mt-2 flex w-fit items-center justify-center rounded-lg bg-accent-500 px-4 py-2 shadow transition-all duration-700 ease-in-out hover:bg-accent-600 sm:mt-0'>
              <span class='text-sm font-medium whitespace-nowrap text-white'
                >Notify Me</span
              >
            </button>
          </form>
        </div>
      </div>
    </div>
    <p class='mt-6 w-full text-center text-sm font-normal text-gray-200'>
      Get in touch with us:
      <a
        href='mailto:info@acplumb.co.uk'
        class='underline transition-all duration-700 ease-in-out hover:text-white'>
        info@acplumb.co.uk
      </a>
    </p>
  </section>
</Layout>

<!--Javascript-->
<script>
  // count-down timer
  // We want the countdown target to be interpreted in UK time (Europe/London),
  // regardless of where the visitor is located.
  function zonedTimeToEpoch(
    year: number,
    month: number,
    day: number,
    hour = 0,
    minute = 0,
    second = 0,
    timeZone = 'Europe/London'
  ) {
    // Start with a UTC guess
    const utcGuess = Date.UTC(year, month - 1, day, hour, minute, second);

    // Format that instant in the target time zone
    const dtf = new Intl.DateTimeFormat('en-GB', {
      timeZone,
      hour12: false,
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
    });

    const parts = dtf.formatToParts(new Date(utcGuess));
    const map = Object.fromEntries(
      parts.filter(p => p.type !== 'literal').map(p => [p.type, p.value])
    );

    // Interpret the formatted parts as if they were UTC to derive the offset
    const asUTC = Date.UTC(
      Number(map.year),
      Number(map.month) - 1,
      Number(map.day),
      Number(map.hour),
      Number(map.minute),
      Number(map.second)
    );

    // Adjust the guess by the zone offset
    return utcGuess + (utcGuess - asUTC);
  }

  // Countdown target: Feb 28, 2026 00:00:00 in UK time (Europe/London)
  let dest = zonedTimeToEpoch(2026, 2, 28, 0, 0, 0);
  let x = setInterval(function () {
    let now = new Date().getTime();
    let diff = dest - now;
    // If we've reached (or passed) launch time, stop at 00:00:00:00
    if (diff <= 0) {
      const countdownElements =
        document.getElementsByClassName('countdown-element');
      for (let i = 0; i < countdownElements.length; i++) {
        countdownElements[i].innerHTML = '00';
      }
      clearInterval(x);
      return;
    }

    let days = Math.floor(diff / (1000 * 60 * 60 * 24));
    let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    let seconds = Math.floor((diff % (1000 * 60)) / 1000);

    // Pad numbers for display, but keep variables as numbers
    const daysStr = days < 10 ? `0${days}` : `${days}`;
    const hoursStr = hours < 10 ? `0${hours}` : `${hours}`;
    const minutesStr = minutes < 10 ? `0${minutes}` : `${minutes}`;
    const secondsStr = seconds < 10 ? `0${seconds}` : `${seconds}`;

    // Get elements by class name
    let countdownElements =
      document.getElementsByClassName('countdown-element');

    // Loop through the elements and update their content
    for (let i = 0; i < countdownElements.length; i++) {
      let className = countdownElements[i].classList[1]; // Get the second class name
      switch (className) {
        case 'days':
          countdownElements[i].innerHTML = daysStr;
          break;
        case 'hours':
          countdownElements[i].innerHTML = hoursStr;
          break;
        case 'minutes':
          countdownElements[i].innerHTML = minutesStr;
          break;
        case 'seconds':
          countdownElements[i].innerHTML = secondsStr;
          break;
        default:
          break;
      }
    }
  }, 1000);
</script>
