---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import { getCollection } from "astro:content";
import {
  MapPin,
  Phone,
  CheckCircle,
  Star,
  ArrowRight,
  Shield,
  Wrench,
  Thermometer,
  Flame,
  Users,
  Award,
  Home,
  Building,
  Zap,
} from "@lucide/astro";

// Import background images
import brightonBg from "@/images/lavori/viessmann-boiler-closeup-brighton-installation.jpeg";
import hoveBg from "@/images/lavori/radiator-valve-installation-brass-fitting-hove.jpeg";
import lewesBg from "@/images/lavori/vaillant-air-source-heat-pump-brighton-installation.jpeg";
import portsladeBg from "@/images/lavori/compact-cast-iron-radiator-bee-valve-saltdean.jpeg";

const backgroundImages: Record<string, ImageMetadata> = {
  brighton: brightonBg,
  hove: hoveBg,
  lewes: lewesBg,
  portslade: portsladeBg,
};

const serviceLabels: Record<string, string> = {
  "gas-boiler-installation": "Gas Boiler Installation",
  "central-heating-installation": "Central Heating Installation",
  "bathrooms-installation-rennovation": "Bathroom Installation & Renovation",
  "gas-safety-checks-cp12": "Gas Safety Checks (CP12)",
  "smart-thermostats": "Smart Thermostat Upgrades",
  "renewable-air-source-heat-pump": "Heat Pumps & Electric Boilers",
  "all-aspects-of-plumbing-heating-and-gas": "All Plumbing & Heating Services",
};

export async function getStaticPaths() {
  const areaEntries = await getCollection("areas");

  return areaEntries.map((area) => ({
    params: { slug: area.slug },
  }));
}

const { slug } = Astro.params;
const areaEntries = await getCollection("areas");
const areaEntry = areaEntries.find((entry) => entry.slug === slug);

if (!areaEntry) {
  throw new Error(`Area ${slug} not found`);
}

const areaData = areaEntry.data;
const areaName =
  areaData.title?.split(" in ").pop() || areaEntry.slug.replace(/-/g, " ");
const heroTitle =
  areaData.title || `Plumbing & Heating Services in ${areaName}`;
const heroDescription =
  areaData.description ||
  `Professional plumbing, heating, and gas services in ${areaName}.`;
const neighborhoods = areaData.neighborhoods ?? [];
const postcodes = areaData.postcode
  ? areaData.postcode.split(",").map((code) => code.trim())
  : [];
const localInfo =
  areaData.specificContent ||
  `Trusted local engineers providing plumbing, heating, and gas services across ${areaName}.`;
const featuredServices =
  areaData.services?.map((service) => ({
    slug: service,
    label: serviceLabels[service] || service.replace(/-/g, " "),
  })) ?? [];
const backgroundImage =
  backgroundImages[areaEntry.slug] ?? backgroundImages["brighton"];
const defaultHighlights = [
  {
    slug: "gas-boiler-installation",
    label: serviceLabels["gas-boiler-installation"],
  },
  {
    slug: "central-heating-installation",
    label: serviceLabels["central-heating-installation"],
  },
  {
    slug: "bathrooms-installation-rennovation",
    label: serviceLabels["bathrooms-installation-rennovation"],
  },
];

const area = {
  name: areaName,
  title: heroTitle,
  description: heroDescription,
  localInfo,
  neighborhoods: neighborhoods.length
    ? neighborhoods
    : [`${areaName} and surrounding communities`],
  postcodes: postcodes.length ? postcodes.join(", ") : "All BN postcodes",
  responseTime: areaData.responseTime || "30 minutes",
  services: featuredServices.length ? featuredServices : defaultHighlights,
  backgroundImage,
};

const services = [
  {
    icon: Thermometer,
    name: "Boiler Installation",
    desc: "New boiler installations with warranty",
  },
  {
    icon: Wrench,
    name: "Emergency Repairs",
    desc: "24/7 emergency plumbing repairs",
  },
  {
    icon: Flame,
    name: "Heating Systems",
    desc: "Central heating installation & repair",
  },
  {
    icon: Shield,
    name: "Gas Safety",
    desc: "Gas safety checks and certificates",
  },
  {
    icon: Zap,
    name: "Electrical Work",
    desc: "Electrical work for heating systems",
  },
  {
    icon: Home,
    name: "Bathroom Fitting",
    desc: "Complete bathroom installations",
  },
];

const whyChooseUs = [
  {
    icon: MapPin,
    title: "Local to " + area.name,
    desc: "Based locally with fast response times",
  },
  {
    icon: Shield,
    title: "Fully Insured",
    desc: "Comprehensive insurance and Gas Safe registered",
  },
  {
    icon: Award,
    title: "Quality Guaranteed",
    desc: "All work comes with our quality guarantee",
  },
  {
    icon: Users,
    title: "Trusted Engineers",
    desc: "Experienced, friendly, professional team",
  },
];
---

<BaseLayout title={area.title} description={area.description}>
  <!-- Hero Section -->
  <section
    class="relative mt-24 overflow-hidden pt-16 pb-16 md:mt-28 md:pt-20 md:pb-20"
  >
    <!-- Background Image -->
    <div class="absolute inset-0 z-0">
      <Image
        src={area.backgroundImage}
        alt={`Plumbing and heating work in ${area.name}`}
        class="h-full w-full object-cover"
        quality={90}
        format="webp"
      />
      <!-- Overlay -->
      <div
        class="absolute inset-0 bg-gradient-to-r from-primary-900/70 via-primary-800/50 to-primary-700/40"
      >
      </div>
    </div>

    <!-- Content -->
    <div class="relative z-10 mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid items-center gap-12 lg:grid-cols-2">
        <div>
          <div class="mb-4 flex items-center gap-2">
            <MapPin class="h-5 w-5 text-primary-100" />
            <span class="font-medium text-primary-100">Serving {area.name}</span
            >
          </div>

          <h1 class="text-4xl font-bold text-white md:text-5xl lg:text-6xl">
            Plumbing & Heating in {area.name}
          </h1>

          <p class="mt-6 text-lg text-primary-100 md:text-xl">
            {area.localInfo}
          </p>

          <div class="mt-8 flex flex-col gap-4 sm:flex-row">
            <a
              href="tel:01273123456"
              class="inline-flex items-center justify-center gap-2 rounded-lg bg-white px-6 py-3 font-semibold text-primary-600 transition-colors hover:bg-gray-100"
            >
              <Phone class="h-5 w-5" />
              Call 01273 123 456
            </a>
            <a
              href="/contact-us"
              class="inline-flex items-center justify-center gap-2 rounded-lg border-2 border-white px-6 py-3 font-semibold text-white transition-colors hover:bg-white hover:text-primary-600"
            >
              Get a Quote
              <ArrowRight class="h-4 w-4" />
            </a>
          </div>

          <div
            class="mt-6 flex flex-wrap items-center gap-4 text-sm text-primary-200"
          >
            <div class="flex items-center gap-2">
              <CheckCircle class="h-4 w-4 text-primary-100" />
              Local {area.name} engineers
            </div>
            <div class="flex items-center gap-2">
              <CheckCircle class="h-4 w-4 text-primary-100" />
              Average response time: {area.responseTime}
            </div>
          </div>
        </div>

        <div class="relative">
          <div class="relative">
            <div
              class="rounded-2xl border border-white/20 bg-white/95 p-6 shadow-xl backdrop-blur-sm"
            >
              <h3 class="mb-4 text-lg font-semibold text-gray-900">
                Areas We Cover in {area.name}
              </h3>
              <div class="grid grid-cols-2 gap-3">
                {
                  area.neighborhoods.map((neighborhood: string) => (
                    <div class="flex items-center gap-2 text-sm text-gray-700">
                      <span class="h-1.5 w-1.5 rounded-full bg-primary-600" />
                      {neighborhood}
                    </div>
                  ))
                }
              </div>
              <div class="mt-4 border-t border-gray-200 pt-4">
                <p class="text-sm text-gray-600">
                  <strong>Postcodes:</strong>
                  {area.postcodes}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="bg-white py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-12 text-center">
        <h2 class="text-3xl font-bold text-gray-900 md:text-4xl">
          Our Services in {area.name}
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Comprehensive plumbing and heating services for {area.name} residents
        </p>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {
          services.map((service) => {
            const Icon = service.icon;
            return (
              <div class="rounded-lg border border-gray-200 bg-gray-50 p-6 transition-colors hover:border-primary-300 hover:bg-primary-50">
                <div class="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-primary-100">
                  <Icon class="h-6 w-6 text-primary-600" />
                </div>
                <h3 class="mb-2 text-lg font-semibold text-gray-900">
                  {service.name}
                </h3>
                <p class="text-gray-600">{service.desc}</p>
              </div>
            );
          })
        }
      </div>
    </div>
  </section>

  <!-- Local Specialties -->
  <section class="bg-gray-50 py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-12 text-center">
        <h2 class="text-3xl font-bold text-gray-900 md:text-4xl">
          Featured Services in {area.name}
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Popular plumbing and heating services chosen by {area.name} customers
        </p>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
        {
          area.services.map((service) => (
            <a
              href={`/services/${service.slug}`}
              class="block rounded-lg bg-white p-6 text-center shadow-sm transition hover:shadow-md"
            >
              <Star class="mx-auto mb-3 h-8 w-8 text-primary-600" />
              <h3 class="font-semibold text-gray-900">{service.label}</h3>
            </a>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <section class="bg-white py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-12 text-center">
        <h2 class="text-3xl font-bold text-gray-900 md:text-4xl">
          Why Choose Us in {area.name}?
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Local expertise and professional service you can trust
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-4">
        {
          whyChooseUs.map((point) => {
            const Icon = point.icon;
            return (
              <div class="text-center">
                <div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-primary-100">
                  <Icon class="h-8 w-8 text-primary-600" />
                </div>
                <h3 class="mb-2 text-lg font-semibold text-gray-900">
                  {point.title}
                </h3>
                <p class="text-gray-600">{point.desc}</p>
              </div>
            );
          })
        }
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-primary-600 py-16">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-white md:text-4xl">
        Need a Plumber in {area.name}?
      </h2>
      <p class="mt-4 text-xl text-primary-100">
        Get in touch today for a free quote on your plumbing or heating needs.
      </p>
      <div class="mt-8 flex flex-col justify-center gap-4 sm:flex-row">
        <a
          href="tel:01273123456"
          class="inline-flex items-center justify-center gap-2 rounded-lg bg-white px-8 py-4 font-semibold text-primary-600 transition-colors hover:bg-gray-100"
        >
          <Phone class="h-5 w-5" />
          Call Now: 01273 123 456
        </a>
        <a
          href="/contact-us"
          class="inline-flex items-center justify-center gap-2 rounded-lg border-2 border-white px-8 py-4 font-semibold text-white transition-colors hover:bg-white hover:text-primary-600"
        >
          Request Quote
          <ArrowRight class="h-4 w-4" />
        </a>
      </div>

      <div class="mt-8 text-center">
        <p class="text-primary-100">
          Serving all areas of {area.name} • Same day service available • Free quotes
        </p>
      </div>
    </div>
  </section>
</BaseLayout>
