---
import { Image } from "astro:assets";
import vaillant from "@/images/brands/vaillant-installer-logo-brighton-boilers.jpg";
import viesmann from "@/images/brands/viessmann-logo-boiler-installation-brighton.jpg";
import bpec from "@/images/brands/bpec-certification-logo-gas-plumbing.png";
import checktrade from "@/images/brands/checkatrade-logo-ac-plumbers-brighton.png";
import gasSafe from "@/images/brands/gas-safe-register-logo-certified-brighton.png";
import oftec1 from "@/images/brands/oftec-registered-logo-heating-certification-1.png";
import oftec2 from "@/images/brands/oftec-registered-logo-heating-certification.jpg";

import Text from "./fundations/elements/Text.astro";
---

<section
  class="py-3 backdrop-blur-sm transition-all duration-300"
  id="certifications"
  aria-labelledby="certifications-heading"
>
  <div class="border-t- mx-auto max-w-7xl px-6 lg:px-8">
    <!-- <Text
      tag="h2"
      variant="textLG"
      class="mb-12 text-center font-medium text-gray-600"
      id="certifications-heading"
    >
      Certified & Trusted Partners
    </Text> -->

    <div class="relative overflow-x-hidden">
      <div
        class="scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent animate-logo-scroll flex snap-x snap-mandatory gap-4 py-1 md:animate-none md:gap-6 md:overflow-visible md:py-0"
        tabindex="0"
        aria-label="Brand certifications and partners"
      >
        {/* Logo row, duplicated for seamless scroll */}
        {
          /* Seamless infinite scroll: duplicate the logo set, animate by one set's width */
        }
        {
          (() => {
            const logos = [
              {
                src: vaillant,
                alt: "Vaillant Advance Installer certification",
              },
              { src: viesmann, alt: "Viessmann certified installer" },
              {
                src: bpec,
                alt: "BPEC certified gas and plumbing professional",
              },
              { src: checktrade, alt: "Checkatrade verified tradesperson" },
              { src: gasSafe, alt: "Gas Safe Register certified engineer" },
              {
                src: oftec1,
                alt: "OFTEC registered heating certification (variant 1)",
              },
            ];
            // Render two sets for seamless scroll
            return [...logos, ...logos].map((logo, i) => (
              <div
                class="flex h-12 w-28 flex-shrink-0 snap-start items-center justify-center overflow-hidden p-2 shadow-sm transition-all duration-200 hover:scale-105 hover:shadow-md md:h-14 md:w-32"
                aria-hidden={i >= logos.length ? "true" : "false"}
              >
                <Image
                  class="h-auto max-h-full w-full max-w-full object-contain object-center opacity-80 transition-opacity hover:opacity-100"
                  src={logo.src}
                  alt={logo.alt}
                  width={200}
                  height={100}
                  format="webp"
                  quality={90}
                />
              </div>
            ));
          })()
        }
      </div>
      {/* Gradient fade left/right for scroll hint */}
      <div
        class="pointer-events-none absolute top-0 left-0 h-full w-6 bg-gradient-to-r from-white/95 via-white/80 to-transparent md:hidden"
        aria-hidden="true"
      >
      </div>
      <div
        class="pointer-events-none absolute top-0 right-0 h-full w-6 bg-gradient-to-l from-white/95 via-white/80 to-transparent md:hidden"
        aria-hidden="true"
      >
      </div>
      <style>
        @media (max-width: 767px) {
          .animate-logo-scroll {
            animation: logo-scroll 16s linear infinite;
            width: max-content;
          }
          @keyframes logo-scroll {
            0% {
              transform: translateX(0);
            }
            100% {
              transform: translateX(-50%);
            }
          }
        }
      </style>
    </div>
  </div>

  <script is:inline>
    // Optimized scroll handler - logo cloud disappears smoothly
    let isScrolled = false;
    let ticking = false;
    let certificationSection = null;

    function updateVisibility() {
      if (!certificationSection) {
        certificationSection = document.getElementById("certifications");
        if (!certificationSection) return;
      }

      const shouldHide = window.scrollY > 50;

      if (shouldHide !== isScrolled) {
        isScrolled = shouldHide;

        if (shouldHide) {
          // Fade out and collapse height smoothly
          certificationSection.style.opacity = "0";
          certificationSection.style.maxHeight = "0";
          certificationSection.style.paddingTop = "0";
          certificationSection.style.paddingBottom = "0";
          certificationSection.style.overflow = "hidden";
        } else {
          // Fade in and restore height
          certificationSection.style.opacity = "1";
          certificationSection.style.maxHeight = "200px"; // Adjust based on your content height
          certificationSection.style.paddingTop = "0.75rem"; // py-3
          certificationSection.style.paddingBottom = "0.75rem"; // py-3
          certificationSection.style.overflow = "visible";
        }
      }
      ticking = false;
    }

    function handleScroll() {
      if (!ticking) {
        requestAnimationFrame(updateVisibility);
        ticking = true;
      }
    }

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", function () {
        window.addEventListener("scroll", handleScroll, { passive: true });
        updateVisibility();
      });
    } else {
      window.addEventListener("scroll", handleScroll, { passive: true });
      updateVisibility();
    }
  </script>
</section>
