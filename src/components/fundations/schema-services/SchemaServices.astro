---
// Props: services (array), providerName (string), providerUrl (string)
const { services = [], providerName = "AC Plumbers Ltd.", providerUrl = "https://acplumb.co.uk" } = Astro.props;

const validServices = services.filter(service =>
	service &&
	typeof service.data?.title === 'string' &&
	typeof service.data?.description === 'string' &&
	typeof service.slug === 'string' &&
	typeof service.data?.image === 'string'
);

const catalog = {
	"@context": "https://schema.org",
	"@type": "ServiceCatalog",
	"name": "Our Services",
	"description": "Comprehensive plumbing, heating, and gas services for homes and businesses across Brighton & Hove.",
	"provider": {
		"@type": "Organization",
		"name": providerName,
		"url": providerUrl
	},
	"hasOfferCatalog": {
		"@type": "OfferCatalog",
		"name": "Service List",
		"itemListElement": validServices.map(service => ({
			"@type": "Offer",
			"itemOffered": {
				"@type": "Service",
				"name": String(service.data.title),
				"description": String(service.data.description),
				"url": providerUrl + "/services/" + String(service.slug),
				"image": providerUrl + String(service.data.image)
			}
		}))
	}
};
---
<script type="application/ld+json">{JSON.stringify(catalog, null, 2)}</script>
